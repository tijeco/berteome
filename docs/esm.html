---

title: OOP attempt


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/02_esm.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_esm.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="naturalAAIndex" class="doc_header"><code>naturalAAIndex</code><a href="https://github.com/tijeco/berteome/tree/{branch}/berteome/esm.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>naturalAAIndex</code>(<strong><code>aas</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">naturalAAIndex</span><span class="p">(</span><span class="s2">&quot;ACDEFGHIKLMNPQRSTVWY&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="maskifySeq" class="doc_header"><code>maskifySeq</code><a href="https://github.com/tijeco/berteome/tree/{branch}/berteome/esm.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>maskifySeq</code>(<strong><code>seq</code></strong>, <strong><code>i</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getNatProbs" class="doc_header"><code>getNatProbs</code><a href="https://github.com/tijeco/berteome/tree/{branch}/berteome/esm.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getNatProbs</code>(<strong><code>natAAList</code></strong>, <strong><code>probList</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">alphabet</span><span class="o">.</span><span class="n">all_toks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">naturalAAIndex</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;A&#39;,
 &#39;C&#39;,
 &#39;D&#39;,
 &#39;E&#39;,
 &#39;F&#39;,
 &#39;G&#39;,
 &#39;H&#39;,
 &#39;I&#39;,
 &#39;K&#39;,
 &#39;L&#39;,
 &#39;M&#39;,
 &#39;N&#39;,
 &#39;P&#39;,
 &#39;Q&#39;,
 &#39;R&#39;,
 &#39;S&#39;,
 &#39;T&#39;,
 &#39;V&#39;,
 &#39;W&#39;,
 &#39;Y&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Maybe this should be renamed to esmPredictionDF</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="esmPredictionDF" class="doc_header"><code>esmPredictionDF</code><a href="https://github.com/tijeco/berteome/tree/{branch}/berteome/esm.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>esmPredictionDF</code>(<strong><code>seq</code></strong>, <strong><code>aas</code></strong>=<em><code>'ACDEFGHIKLMNPQRSTVWY'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">esmPredictionDF</span><span class="p">(</span><span class="s2">&quot;MENDEL&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wt</th>
      <th>wtIndex</th>
      <th>A</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
      <th>G</th>
      <th>H</th>
      <th>I</th>
      <th>...</th>
      <th>M</th>
      <th>N</th>
      <th>P</th>
      <th>Q</th>
      <th>R</th>
      <th>S</th>
      <th>T</th>
      <th>V</th>
      <th>W</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>1</td>
      <td>0.033952</td>
      <td>0.007039</td>
      <td>0.054737</td>
      <td>0.063365</td>
      <td>0.018590</td>
      <td>0.029267</td>
      <td>0.010216</td>
      <td>0.028865</td>
      <td>...</td>
      <td>0.456082</td>
      <td>0.029166</td>
      <td>0.023344</td>
      <td>0.019043</td>
      <td>0.023603</td>
      <td>0.030170</td>
      <td>0.023352</td>
      <td>0.033982</td>
      <td>0.004791</td>
      <td>0.013076</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E</td>
      <td>2</td>
      <td>0.058999</td>
      <td>0.021031</td>
      <td>0.054622</td>
      <td>0.072057</td>
      <td>0.037186</td>
      <td>0.053090</td>
      <td>0.025848</td>
      <td>0.065879</td>
      <td>...</td>
      <td>0.024329</td>
      <td>0.059710</td>
      <td>0.035728</td>
      <td>0.040369</td>
      <td>0.052300</td>
      <td>0.073618</td>
      <td>0.057319</td>
      <td>0.062975</td>
      <td>0.014029</td>
      <td>0.030339</td>
    </tr>
    <tr>
      <th>2</th>
      <td>N</td>
      <td>3</td>
      <td>0.055626</td>
      <td>0.014060</td>
      <td>0.077887</td>
      <td>0.122153</td>
      <td>0.034727</td>
      <td>0.058822</td>
      <td>0.019171</td>
      <td>0.061401</td>
      <td>...</td>
      <td>0.031318</td>
      <td>0.044172</td>
      <td>0.029668</td>
      <td>0.034335</td>
      <td>0.052372</td>
      <td>0.057394</td>
      <td>0.047432</td>
      <td>0.069432</td>
      <td>0.013282</td>
      <td>0.025859</td>
    </tr>
    <tr>
      <th>3</th>
      <td>D</td>
      <td>4</td>
      <td>0.044610</td>
      <td>0.017627</td>
      <td>0.036298</td>
      <td>0.071025</td>
      <td>0.031629</td>
      <td>0.049782</td>
      <td>0.023518</td>
      <td>0.061833</td>
      <td>...</td>
      <td>0.058515</td>
      <td>0.043762</td>
      <td>0.037227</td>
      <td>0.054164</td>
      <td>0.055120</td>
      <td>0.060091</td>
      <td>0.052912</td>
      <td>0.070125</td>
      <td>0.017567</td>
      <td>0.027211</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E</td>
      <td>5</td>
      <td>0.045966</td>
      <td>0.027927</td>
      <td>0.047431</td>
      <td>0.057574</td>
      <td>0.052450</td>
      <td>0.054545</td>
      <td>0.030670</td>
      <td>0.071293</td>
      <td>...</td>
      <td>0.025417</td>
      <td>0.051106</td>
      <td>0.033450</td>
      <td>0.038940</td>
      <td>0.055194</td>
      <td>0.076423</td>
      <td>0.050060</td>
      <td>0.063550</td>
      <td>0.017663</td>
      <td>0.038091</td>
    </tr>
    <tr>
      <th>5</th>
      <td>L</td>
      <td>6</td>
      <td>0.048226</td>
      <td>0.016231</td>
      <td>0.060284</td>
      <td>0.100391</td>
      <td>0.031534</td>
      <td>0.052584</td>
      <td>0.023015</td>
      <td>0.065281</td>
      <td>...</td>
      <td>0.029354</td>
      <td>0.063840</td>
      <td>0.025546</td>
      <td>0.039313</td>
      <td>0.062937</td>
      <td>0.064147</td>
      <td>0.053790</td>
      <td>0.060177</td>
      <td>0.013714</td>
      <td>0.028147</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 22 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mendel</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;wt&quot;</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot;MENDEL&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mendel</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;wtIndex&quot;</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;MENDEL&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mendel</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wt</th>
      <th>wtIndex</th>
      <th>A</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
      <th>G</th>
      <th>H</th>
      <th>I</th>
      <th>...</th>
      <th>M</th>
      <th>N</th>
      <th>P</th>
      <th>Q</th>
      <th>R</th>
      <th>S</th>
      <th>T</th>
      <th>V</th>
      <th>W</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M</td>
      <td>1</td>
      <td>0.033952</td>
      <td>0.007039</td>
      <td>0.054737</td>
      <td>0.063365</td>
      <td>0.018590</td>
      <td>0.029267</td>
      <td>0.010216</td>
      <td>0.028865</td>
      <td>...</td>
      <td>0.456082</td>
      <td>0.029166</td>
      <td>0.023344</td>
      <td>0.019043</td>
      <td>0.023603</td>
      <td>0.030170</td>
      <td>0.023352</td>
      <td>0.033982</td>
      <td>0.004791</td>
      <td>0.013076</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E</td>
      <td>2</td>
      <td>0.058999</td>
      <td>0.021031</td>
      <td>0.054622</td>
      <td>0.072057</td>
      <td>0.037186</td>
      <td>0.053090</td>
      <td>0.025848</td>
      <td>0.065879</td>
      <td>...</td>
      <td>0.024329</td>
      <td>0.059710</td>
      <td>0.035728</td>
      <td>0.040369</td>
      <td>0.052300</td>
      <td>0.073618</td>
      <td>0.057319</td>
      <td>0.062975</td>
      <td>0.014029</td>
      <td>0.030339</td>
    </tr>
    <tr>
      <th>2</th>
      <td>N</td>
      <td>3</td>
      <td>0.055626</td>
      <td>0.014060</td>
      <td>0.077887</td>
      <td>0.122153</td>
      <td>0.034727</td>
      <td>0.058822</td>
      <td>0.019171</td>
      <td>0.061401</td>
      <td>...</td>
      <td>0.031318</td>
      <td>0.044172</td>
      <td>0.029668</td>
      <td>0.034335</td>
      <td>0.052372</td>
      <td>0.057394</td>
      <td>0.047432</td>
      <td>0.069432</td>
      <td>0.013282</td>
      <td>0.025859</td>
    </tr>
    <tr>
      <th>3</th>
      <td>D</td>
      <td>4</td>
      <td>0.044610</td>
      <td>0.017627</td>
      <td>0.036298</td>
      <td>0.071025</td>
      <td>0.031629</td>
      <td>0.049782</td>
      <td>0.023518</td>
      <td>0.061833</td>
      <td>...</td>
      <td>0.058515</td>
      <td>0.043762</td>
      <td>0.037227</td>
      <td>0.054164</td>
      <td>0.055120</td>
      <td>0.060091</td>
      <td>0.052912</td>
      <td>0.070125</td>
      <td>0.017567</td>
      <td>0.027211</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E</td>
      <td>5</td>
      <td>0.045966</td>
      <td>0.027927</td>
      <td>0.047431</td>
      <td>0.057574</td>
      <td>0.052450</td>
      <td>0.054545</td>
      <td>0.030670</td>
      <td>0.071293</td>
      <td>...</td>
      <td>0.025417</td>
      <td>0.051106</td>
      <td>0.033450</td>
      <td>0.038940</td>
      <td>0.055194</td>
      <td>0.076423</td>
      <td>0.050060</td>
      <td>0.063550</td>
      <td>0.017663</td>
      <td>0.038091</td>
    </tr>
    <tr>
      <th>5</th>
      <td>L</td>
      <td>6</td>
      <td>0.048226</td>
      <td>0.016231</td>
      <td>0.060284</td>
      <td>0.100391</td>
      <td>0.031534</td>
      <td>0.052584</td>
      <td>0.023015</td>
      <td>0.065281</td>
      <td>...</td>
      <td>0.029354</td>
      <td>0.063840</td>
      <td>0.025546</td>
      <td>0.039313</td>
      <td>0.062937</td>
      <td>0.064147</td>
      <td>0.053790</td>
      <td>0.060177</td>
      <td>0.013714</td>
      <td>0.028147</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 22 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ESM1b</span><span class="p">():</span>
  <span class="n">aas</span> <span class="o">=</span> <span class="s2">&quot;ACDEFGHIKLMNPQRSTVWY&quot;</span>
  
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
    <span class="n">naturalAA_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">naturalAAIndex</span><span class="p">()</span>
    <span class="c1"># print(&quot;naturalAA_indices&quot;,naturalAA_indices)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">esmDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">esm2DF</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">naturalAA_indices</span><span class="p">)</span><span class="c1">#????</span>
  <span class="k">def</span> <span class="nf">maskifySeq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="n">seqList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
    <span class="n">seqList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;mask&gt;&quot;</span>
    <span class="k">return</span> <span class="n">seqList</span>

  <span class="k">def</span> <span class="nf">getNatProbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">natAAList</span><span class="p">,</span><span class="n">probList</span><span class="p">):</span>
    <span class="n">natProbList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">natAAIndex</span> <span class="ow">in</span> <span class="n">natAAList</span><span class="p">:</span>
      <span class="n">natProbList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probList</span><span class="p">[</span><span class="n">natAAIndex</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">natProbList</span>
  
  <span class="k">def</span> <span class="nf">naturalAAIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">model_alphabet</span><span class="o">=</span><span class="n">alphabet</span><span class="o">.</span><span class="n">all_toks</span>
    <span class="n">naturalAAIndices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aas</span><span class="p">:</span>
      <span class="n">naturalAAIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_alphabet</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">aa</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">naturalAAIndices</span>

  <span class="k">def</span> <span class="nf">esm2DF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">naturalAAIndices</span><span class="p">):</span> <span class="c1"># this should probably be a class where model/alphabet are declared??</span>
    <span class="n">esmPredDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">wtIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)):</span>
      <span class="n">maskSeq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskifySeq</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">wtIndex</span><span class="p">)</span> <span class="c1"># import from other module, ie seqtools.maskifySeq(), or not, maybe both classes should just be in the same module...</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;protein1&quot;</span><span class="p">,</span> <span class="n">maskSeq</span><span class="p">)]</span>
      <span class="n">batch_labels</span><span class="p">,</span> <span class="n">batch_strs</span><span class="p">,</span> <span class="n">batch_tokens</span> <span class="o">=</span> <span class="n">batch_converter</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
      <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">batch_tokens</span><span class="p">)</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;logits&#39;</span><span class="p">]</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">prob</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="n">esmPredDict</span><span class="p">[</span><span class="n">wtIndex</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNatProbs</span><span class="p">(</span><span class="n">naturalAAIndices</span><span class="p">,</span><span class="n">prob</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
      
      <span class="c1"># print(len(list(self.getNatProbs(naturalAAIndices,prob[0]))))</span>
      <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">wtIndex</span> <span class="o">+</span><span class="mi">1</span> <span class="p">]))</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">naturalAAIndices</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNatProbs</span><span class="p">(</span><span class="n">naturalAAIndices</span><span class="p">,</span><span class="n">prob</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">wtIndex</span> <span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">esmPredDict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
      
  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mendel</span> <span class="o">=</span> <span class="n">ESM1b</span><span class="p">(</span><span class="s2">&quot;MENDEL&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>naturalAA_indices [5, 23, 13, 9, 18, 6, 21, 12, 15, 4, 20, 17, 14, 16, 10, 8, 11, 7, 22, 19]
torch.Size([1, 8, 33])
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IndexError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/x1/098shbqn0rs8vd5ybvyb0k9h0000gn/T/ipykernel_57362/2904008813.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>mendel <span class="ansi-blue-fg">=</span> ESM1b<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;MENDEL&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/var/folders/x1/098shbqn0rs8vd5ybvyb0k9h0000gn/T/ipykernel_57362/2406275320.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, seq)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     naturalAA_indices <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>naturalAAIndex<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;naturalAA_indices&#34;</span><span class="ansi-blue-fg">,</span>naturalAA_indices<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg">     </span>self<span class="ansi-blue-fg">.</span>esmDF <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>esm2DF<span class="ansi-blue-fg">(</span>seq<span class="ansi-blue-fg">,</span>naturalAA_indices<span class="ansi-blue-fg">)</span><span class="ansi-red-fg">#????</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>   <span class="ansi-green-fg">def</span> maskifySeq<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> seq<span class="ansi-blue-fg">,</span> i<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>     seqList <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>seq<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/var/folders/x1/098shbqn0rs8vd5ybvyb0k9h0000gn/T/ipykernel_57362/2406275320.py</span> in <span class="ansi-cyan-fg">esm2DF</span><span class="ansi-blue-fg">(self, seq, naturalAAIndices)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>         prob <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>softmax<span class="ansi-blue-fg">(</span>logits<span class="ansi-blue-fg">,</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>       print<span class="ansi-blue-fg">(</span>prob<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-fg">       </span>esmPredDict<span class="ansi-blue-fg">[</span>wtIndex<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>getNatProbs<span class="ansi-blue-fg">(</span>naturalAAIndices<span class="ansi-blue-fg">,</span>prob<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span> 
<span class="ansi-green-intense-fg ansi-bold">     40</span>       <span class="ansi-red-fg"># print(len(list(self.getNatProbs(naturalAAIndices,prob[0]))))</span>

<span class="ansi-green-fg">/var/folders/x1/098shbqn0rs8vd5ybvyb0k9h0000gn/T/ipykernel_57362/2406275320.py</span> in <span class="ansi-cyan-fg">getNatProbs</span><span class="ansi-blue-fg">(self, natAAList, probList)</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span>     natProbList <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span>     <span class="ansi-green-fg">for</span> natAAIndex <span class="ansi-green-fg">in</span> natAAList<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 16</span><span class="ansi-red-fg">       </span>natProbList<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>probList<span class="ansi-blue-fg">[</span>natAAIndex<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     17</span>     <span class="ansi-green-fg">return</span> natProbList
<span class="ansi-green-intense-fg ansi-bold">     18</span> 

<span class="ansi-red-fg">IndexError</span>: index 23 is out of bounds for dimension 0 with size 8</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Why do I even bother with OOP!!! I can't really test / sanity check these functions because they are wrapped in to the class. Also I really just need to decide what is and isn't to be configurable. I guess that can be decided later.</p>
<p>Write silly easily testable functions first, put them in a class later!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mendel</span><span class="o">.</span><span class="n">esmDF</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>tensor(0.0340)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>tensor(0.0590)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>tensor(0.0556)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>tensor(0.0446)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>tensor(0.0460)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>tensor(0.0482)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

